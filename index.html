<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1a2e">
    <title>Fruit Merge Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Top Bar -->
        <div id="top-bar">
            <div class="top-left">
                <div class="stars-display">
                    <span id="header-stars">0</span> â­
                </div>
            </div>
            <div class="top-center">
                <div class="score-display">
                    <span class="score-label">SCORE</span>
                    <span class="score-value" id="current-score">0</span>
                </div>
                <div class="best-display">
                    <span class="score-label">BEST</span>
                    <span class="score-value" id="best-score">0</span>
                </div>
            </div>
            <div class="top-right">
                <button class="top-btn" id="profile-btn" onclick="openModal('profile-modal')">ğŸ‘¤</button>
                <button class="top-btn" id="sound-btn">ğŸ”Š</button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area">
            <div id="game-container"></div>
            
            <!-- Next Fruit (floating) -->
            <div id="next-fruit-floating">
                <span>NEXT</span>
                <div id="next-fruit-display"></div>
            </div>
        </div>

        <!-- Bottom Menu -->
        <div id="bottom-menu">
            <!-- Power-ups -->
            <div id="powerups-row">
                <button class="powerup-btn" id="powerup-clear">
                    <span class="pu-icon">ğŸ§¹</span>
                    <span class="pu-count" id="clear-count">0</span>
                </button>
                <button class="powerup-btn" id="powerup-shake">
                    <span class="pu-icon">ğŸ“³</span>
                    <span class="pu-count" id="shake-count">0</span>
                </button>
                <button class="powerup-btn" id="powerup-upgrade">
                    <span class="pu-icon">â¬†ï¸</span>
                    <span class="pu-count" id="upgrade-count">0</span>
                </button>
            </div>
            
            <!-- Menu Buttons -->
            <div id="menu-row">
                <button class="menu-btn" onclick="openModal('daily-modal')">
                    <span class="menu-icon">ğŸ“…</span>
                    <span class="menu-label">Daily</span>
                    <span class="menu-badge" id="daily-badge"></span>
                </button>
                <button class="menu-btn" onclick="openModal('wheel-modal')">
                    <span class="menu-icon">ğŸ¡</span>
                    <span class="menu-label">Wheel</span>
                    <span class="menu-badge" id="wheel-badge"></span>
                </button>
                <button class="menu-btn" onclick="openModal('shop-modal')">
                    <span class="menu-icon">ğŸ›’</span>
                    <span class="menu-label">Shop</span>
                </button>
                <button class="menu-btn" onclick="openModal('skins-modal')">
                    <span class="menu-icon">ğŸ¨</span>
                    <span class="menu-label">Skins</span>
                </button>
                <button class="menu-btn" onclick="openModal('leaderboard-modal')">
                    <span class="menu-icon">ğŸ†</span>
                    <span class="menu-label">Rank</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== MODALS ==================== -->

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content">
            <h2>ğŸ® Game Over!</h2>
            <div class="final-score" id="final-score">0</div>
            <div class="best-score-text">Best: <span id="modal-best-score">0</span></div>
            <div class="new-best" id="new-best-badge" style="display:none;">ğŸ‰ NEW BEST!</div>
            
            <div class="modal-buttons">
                <button class="btn btn-primary" id="restart-btn">â–¶ï¸ Play Again</button>
                <button class="btn btn-gold" id="revive-btn">
                    ğŸ’« Continue <span class="btn-price">1x</span>
                </button>
                <button class="btn btn-secondary" id="share-btn">ğŸ“¤ Share</button>
            </div>
        </div>
    </div>

    <!-- Daily Modal -->
    <div id="daily-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ“… Daily Rewards</h2>
                <button class="close-btn" onclick="closeModal('daily-modal')">&times;</button>
            </div>
            
            <!-- Check-in -->
            <div class="section-title">ğŸ Daily Check-in</div>
            <div id="checkin-days" class="checkin-grid"></div>
            <button class="btn btn-primary btn-full" id="checkin-btn" onclick="DailySystem.checkIn(); DailySystem.updateCheckInUI();">
                ğŸ“… Check In
            </button>
            
            <!-- Tasks -->
            <div class="section-title" style="margin-top:20px;">ğŸ“‹ Daily Tasks</div>
            <div id="tasks-list" class="tasks-list"></div>
        </div>
    </div>

    <!-- Wheel Modal -->
    <div id="wheel-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ¡ Lucky Wheel</h2>
                <button class="close-btn" onclick="closeModal('wheel-modal')">&times;</button>
            </div>
            
            <div class="wheel-container">
                <div class="wheel-pointer">â–¼</div>
                <div id="wheel-spinner">
                    <canvas id="wheel-canvas" width="280" height="280"></canvas>
                </div>
            </div>
            
            <div class="wheel-buttons">
                <button class="btn btn-primary" id="spin-free-btn" onclick="LuckyWheel.spin(false)">
                    ğŸ¡ Free Spin (1)
                </button>
                <button class="btn btn-gold" id="spin-paid-btn" onclick="LuckyWheel.spin(true)">
                    ğŸ¡ Spin (20â­)
                </button>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shop-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ›’ Shop</h2>
                <button class="close-btn" onclick="closeModal('shop-modal')">&times;</button>
            </div>
            <div class="stars-bar">
                Your Stars: <span id="user-stars">0</span> â­
            </div>
            <div class="shop-items" id="shop-items-container"></div>
        </div>
    </div>

    <!-- Skins Modal -->
    <div id="skins-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ¨ Skins</h2>
                <button class="close-btn" onclick="closeModal('skins-modal')">&times;</button>
            </div>
            <div id="skins-list" class="skins-list"></div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ† Leaderboard</h2>
                <button class="close-btn" onclick="closeModal('leaderboard-modal')">&times;</button>
            </div>
            <div class="leaderboard-tabs">
                <button class="tab-btn active" data-tab="global">Global</button>
                <button class="tab-btn" data-tab="friends">Friends</button>
            </div>
            <div class="leaderboard-list" id="leaderboard-list"></div>
            <div class="your-rank">Your Rank: <span id="your-rank">#--</span></div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ‘¤ Profile</h2>
                <button class="close-btn" onclick="closeModal('profile-modal')">&times;</button>
            </div>
            
            <!-- Name Preview -->
            <div class="profile-section">
                <div class="profile-name-preview" id="name-preview">Player</div>
                <button class="btn btn-secondary" id="change-name-btn" onclick="UsernameSystem.showChangeNameDialog()">
                    Change Name (Free)
                </button>
            </div>
            
            <!-- Name Colors -->
            <div class="section-title">ğŸ¨ Name Colors</div>
            <div class="color-list" id="color-list"></div>
            
            <!-- Stats -->
            <div class="section-title">ğŸ“Š Your Stats</div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="stat-value" id="profile-games">0</div>
                    <div class="stat-label">Games</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value" id="profile-best">0</div>
                    <div class="stat-label">Best Score</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value" id="profile-stars">0</div>
                    <div class="stat-label">Stars</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Friends Modal -->
    <div id="friends-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ‘¥ Friends</h2>
                <button class="close-btn" onclick="closeModal('friends-modal')">&times;</button>
            </div>
            <div class="friends-list" id="friends-list"></div>
            <button class="btn btn-primary btn-full" onclick="FriendsSystem.inviteFriend()">
                ğŸ“¨ Invite Friends
            </button>
        </div>
    </div>

    <!-- Sound Settings Modal -->
    <div id="sound-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”Š Sound</h2>
                <button class="close-btn" onclick="closeModal('sound-modal')">&times;</button>
            </div>
            <div class="sound-toggle">
                <span>Sound Effects</span>
                <button class="toggle-btn" id="sound-toggle-btn" onclick="toggleSoundSetting()">ON</button>
            </div>
            <div class="section-title">ğŸµ Sound Packs</div>
            <div id="sound-pack-list" class="sound-pack-list"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Loading -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <div>Loading...</div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="config.js"></script>
    <script src="telegram.js"></script>
    <script src="daily.js"></script>
    <script src="skins.js"></script>
    <script src="username.js"></script>
    <script src="shop.js"></script>
    <script src="leaderboard.js"></script>
    <script src="game.js"></script>
    <script src="app.js"></script>
</body>
</html>
