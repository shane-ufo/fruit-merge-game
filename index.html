<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Fruit Merge Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-wrapper">
        <!-- Header with scores -->
        <div id="header">
            <div class="score-item">
                <div class="score-label">SCORE</div>
                <div class="score-value" id="current-score">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">BEST</div>
                <div class="score-value" id="best-score">0</div>
            </div>
            <button class="icon-btn" id="sound-btn" title="Toggle Sound">ğŸ”Š</button>
            <button class="icon-btn" id="shop-btn" title="Shop">ğŸ›’</button>
            <button class="icon-btn" id="leaderboard-btn" title="Leaderboard">ğŸ†</button>
        </div>
        
        <!-- Game Canvas Container -->
        <div id="game-container"></div>
        
        <!-- Next Fruit Preview -->
        <div id="next-fruit">
            <div id="next-fruit-label">NEXT</div>
            <div id="next-fruit-display"></div>
        </div>

        <!-- Control Hint (for new players) -->
        <div id="control-hint">
            ğŸ‘† Drag to move â€¢ Release to drop
        </div>

        <!-- Power-ups Bar -->
        <div id="powerups-bar">
            <button class="powerup-btn" id="powerup-clear" data-item="clear_small">
                <span class="powerup-icon">ğŸ§¹</span>
                <span class="powerup-count" id="clear-count">0</span>
            </button>
            <button class="powerup-btn" id="powerup-shake" data-item="shake">
                <span class="powerup-icon">ğŸ“³</span>
                <span class="powerup-count" id="shake-count">0</span>
            </button>
            <button class="powerup-btn" id="powerup-upgrade" data-item="upgrade">
                <span class="powerup-icon">â¬†ï¸</span>
                <span class="powerup-count" id="upgrade-count">0</span>
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content game-over-content">
            <h2>ğŸ® Game Over!</h2>
            <div class="final-score" id="final-score">0</div>
            <div class="best-score">Best: <span id="modal-best-score">0</span></div>
            <div class="new-best" id="new-best-badge" style="display:none;">ğŸ‰ NEW BEST!</div>
            
            <div class="modal-buttons">
                <button class="btn btn-primary" id="restart-btn">â–¶ï¸ Play Again</button>
                <button class="btn btn-revive" id="revive-btn">
                    <span>ğŸ’« Continue</span>
                    <span class="price">10 â­</span>
                </button>
                <button class="btn btn-secondary" id="share-btn">ğŸ“¤ Share Score</button>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shop-modal" class="modal">
        <div class="modal-content shop-content">
            <div class="modal-header">
                <h2>ğŸ›’ Shop</h2>
                <button class="close-btn" id="close-shop">&times;</button>
            </div>
            <div class="coins-display">
                <span>Your Stars:</span>
                <span id="user-stars">0</span> â­
            </div>
            <div class="shop-items" id="shop-items-container">
                <!-- Items populated by JS -->
            </div>
        </div>
    </div>

    <!-- Sound Settings Modal -->
    <div id="sound-modal" class="modal">
        <div class="modal-content sound-content">
            <div class="modal-header">
                <h2>ğŸ”Š Sound Settings</h2>
                <button class="close-btn" id="close-sound">&times;</button>
            </div>
            
            <div class="sound-toggle-section">
                <span>Sound Effects</span>
                <button class="toggle-btn" id="sound-toggle-btn">ON</button>
            </div>
            
            <div class="sound-packs-section">
                <h3>ğŸµ Sound Packs</h3>
                <div class="sound-pack-list" id="sound-pack-list">
                    <div class="sound-pack-item active" data-pack="default">
                        <span class="pack-icon">ğŸ®</span>
                        <span class="pack-name">Default</span>
                        <span class="pack-status">âœ“</span>
                    </div>
                    <div class="sound-pack-item locked" data-pack="cute">
                        <span class="pack-icon">ğŸŒ¸</span>
                        <span class="pack-name">Cute</span>
                        <span class="pack-status">ğŸ”’ 50â­</span>
                    </div>
                    <div class="sound-pack-item locked" data-pack="retro">
                        <span class="pack-icon">ğŸ‘¾</span>
                        <span class="pack-name">Retro</span>
                        <span class="pack-status">ğŸ”’ 50â­</span>
                    </div>
                </div>
            </div>
            
            <div class="premium-promo" id="premium-promo">
                <p>ğŸ Unlock ALL sound packs forever!</p>
                <button class="btn btn-buy" id="buy-premium-sounds">
                    Premium Sounds - 100â­
                </button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content leaderboard-content">
            <div class="modal-header">
                <h2>ğŸ† Leaderboard</h2>
                <button class="close-btn" id="close-leaderboard">&times;</button>
            </div>
            <div class="leaderboard-tabs">
                <button class="tab-btn active" data-tab="global">Global</button>
                <button class="tab-btn" data-tab="friends">Friends</button>
                <button class="tab-btn" data-tab="weekly">Weekly</button>
            </div>
            <div class="leaderboard-list" id="leaderboard-list">
                <!-- Populated by JS -->
            </div>
            <div class="your-rank">
                Your Rank: <span id="your-rank">#--</span>
            </div>
        </div>
    </div>

    <!-- Referral Modal -->
    <div id="referral-modal" class="modal">
        <div class="modal-content referral-content">
            <div class="modal-header">
                <h2>ğŸ Invite Friends</h2>
                <button class="close-btn" id="close-referral">&times;</button>
            </div>
            <p>Invite friends and earn rewards!</p>
            <div class="referral-rewards">
                <div class="reward-item">
                    <span>Per friend joined:</span>
                    <span>+50 â­</span>
                </div>
                <div class="reward-item">
                    <span>Friend's first purchase:</span>
                    <span>+10% bonus</span>
                </div>
            </div>
            <div class="referral-stats">
                <div class="stat">
                    <div class="stat-value" id="friends-invited">0</div>
                    <div class="stat-label">Invited</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="stars-earned">0</div>
                    <div class="stat-label">Stars Earned</div>
                </div>
            </div>
            <button class="btn btn-primary" id="invite-btn">ğŸ“¨ Send Invite Link</button>
            <div class="referral-link">
                <input type="text" id="referral-link-input" readonly>
                <button class="copy-btn" id="copy-referral">ğŸ“‹</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <div>Loading...</div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="config.js"></script>
    <script src="telegram.js"></script>
    <script src="shop.js"></script>
    <script src="leaderboard.js"></script>
    <script src="game.js"></script>
    <script src="app.js"></script>
</body>
</html>
